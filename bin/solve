#!/usr/bin/env ruby

require_relative '../osemosys'

begin
  options = Slop.parse do |o|
    o.string '-m', '--s3-model', 'path to Osemosys model file on S3', required: true
    o.string '-d', '--s3-data', 'path to input data file on S3', required: true
    o.string '-b', '--s3-bucket', 'path to input data file on S3', required: true
    o.string '--run-id', 'run id'
    o.on '--help', '-h', 'display the help' do
      puts o
      exit
    end
  end
rescue Slop::Error => e
  puts 'Error processing the options:'
  puts e.message
  exit
end

if options[:'run-id']
  Osemosys::Config.configure do |c|
    c.run_id = options[:'run-id']
  end
end

if options[:'s3-bucket']
  Osemosys::Config.configure do |c|
    c.s3_bucket = options[:'s3-bucket']
  end
end

# TODO: Only pass run-id as an argument?
Osemosys::SolveModel.new(
  s3_data_key: options[:'s3-data'],
  s3_model_key: options[:'s3-model']
).call

# require 'pry'; binding.pry
